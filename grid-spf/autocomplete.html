<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Grid: Data</title>
	<link rel="stylesheet" href="../themes/base/jquery.ui.all.css">
	<link rel="stylesheet" href="grid.css">
	<script src="../jquery-1.5.1.js"></script>
	<script src="../external/jquery.tmpl.js"></script>
	<script src="../ui/jquery.ui.core.js"></script>
	<script src="../ui/jquery.ui.widget.js"></script>
	<script src="../ui/jquery.ui.position.js"></script>
	<script src="../ui/jquery.ui.menu.js"></script>
	<script src="../ui/jquery.ui.autocomplete.js"></script>
	<script src="datasource.js"></script>
	<script src="grid.js"></script>

	<script>
	$(function() {
		var cities = $.dataSource({
			path: "http://ws.geonames.org/searchJSON",
			paging: { take: 10 },
			urlMapper: function(path, queryParams, sort, filter, skip, take) {
				return path + "?" + $.param({
					featureClass: "P",
					style: "full",
					maxRows: take,
					// name_startsWith: filter.term
					name_startsWith: filter[0].filterValue
				});
			},
			resultsFilter: function (data) {
		        this.totalCount = data.totalResultsCount;
		        return $.map( data.geonames, function( item ) {
					return {
						label: item.name + (item.adminName1 ? ", " + item.adminName1 : "") + ", " + item.countryName,
						value: item.name
					}
				});
		    }
		});

		$("#city").autocomplete({
			minLength: 3,
			source: function(request, response) {
				/*
				cities.option("filter", request).refresh(function() {
					response(cities.toArray());
				});
				*/
				cities
					.option("filter", {
						property: "name",
						value: request.term
					})
					.option("refresh", function() {
						response(cities.toArray())
					})
					.refresh();
			}
		})
	});
	</script>
</head>
<body>

<form>
	<label for="city">City</label><input id="city"/>
</form>

</body>
</html>
