<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Grid: Selecting</title>
	<link rel="stylesheet" href="../themes/base/jquery.ui.all.css">
	<link rel="stylesheet" href="../grid-spf/grid.css">
	<script src="../jquery-1.5.1.js"></script>
	<script src="../external/jquery.tmpl.js"></script>
	<script src="../external/jquery.mousewheel-3.0.4.js"></script>
	<script src="../ui/jquery.ui.core.js"></script>
	<script src="../ui/jquery.ui.widget.js"></script>
	<script src="../ui/jquery.ui.mouse.js"></script>
	<script src="../ui/jquery.ui.button.js"></script>
	<script src="../ui/jquery.ui.selectable.js"></script>
	<script src="../ui/jquery.ui.spinner.js"></script>
	<script src="../grid-spf/datasource.js"></script>
	<script src="../grid-spf/datasource-local.js"></script>
	<script src="../grid-spf/grid.js"></script>
	<script src="../grid-spf/pager.js"></script>
	<script>
	var localDevelopers;
	$.ajax({
		dataType: "json",
		url: "../grid-spf/developers.json",
		async: false,
		success: function( result ) {
			localDevelopers = result;
		}
	});

	$(function() {
		var developers = $.ui.localDatasource({
			input: localDevelopers,
			paging: {
				limit: 4
			}
		});

		$( "#developers-local" ).grid({
			source: developers,
			refresh: function() {
				$( this ).find( "tbody tr" ).addClass( function() {
					if ( $( this ).tmplItem().data.selected ) {
						return "ui-selected";
					}
				});

			}
		});
		
		$( "#developers-local" ).selectable({
			filter: "tr",
			stop: function() {
				$( this ).find( "tbody tr" ).each( function() {
					$( this ).tmplItem().data.selected = $( this ).is(".ui-selected");
					// Logging
					if ( $(this).tmplItem().data.selected ) {
						$( "<div></div>" ).text( "Selected " + $(this).text() ).appendTo( ".log" );						
					}
				});
			}
		});
		
		$( ".clearSelection" ).click(function() {
			$.each( localDevelopers, function() { this.selected = false; });
			developers.refresh();
			// Logging
			$( "<div></div>" ).text("Cleared selection").appendTo( ".log" );
		});
		
		$( ".invertSelection" ).click(function() {
			$.each( localDevelopers, function() { this.selected = !this.selected; });
			developers.refresh();
			// Logging
			$( "<div></div>" ).text("Inverted selection").appendTo( ".log" );
		});
		
		$( ".removeSelected" ).click(function() {
			for ( var i = localDevelopers.length - 1; i >= 0; i-- ) {
				if ( localDevelopers[i].selected ) {
					var rem = localDevelopers.splice( i, 1 );
					// Logging
					$( "<div></div>" ).text( "Removed " + rem[0].firstName + " " + rem[0].lastName ).appendTo( ".log" );
				}
			}
			developers.refresh();
		});

		$( "#pageDevelopers" ).pager({
			source: developers
		});

		developers.refresh();
	});
	</script>
	<style>
	.ui-selecting td { background: #eef; }
	.ui-selected td { background: #ddf; }
	</style>
</head>
<body>

<h1>Grids with selectable rows</h1>

<h2>local data source</h2>
<p id="pageDevelopers">
	<button data-page="first">First</button>
	<button data-page="prev">Prev</button>
	<button data-page="prevStep">-1</button>
	<span>
		Page <input class="current" size="4"/>/<span class="total">0</span>,
		Total records <span class="totalRecords">0</span>
	</span>
	<button data-page="nextStep">+1</button>
	<button data-page="next">Next</button>
	<button data-page="last">Last</button>
</p>
<button class="clearSelection">Clear selection</button>
<button class="invertSelection">Invert selection</button>
<button class="removeSelected">Remove selected</button>
<table id="developers-local">
	<thead>
		<tr>
			<!-- see comment in editor.js
			<th data-field="selected" data-type="boolean">Selected</th>
			-->
			<th data-field="firstName">First Name</th>
			<th data-field="lastName">Last Name</th>
			<th data-field="country">Country</th>
			<th data-field="bitcoins" data-type="number">Bitcoins</th>
		</tr>
	</thead>
	<tbody>
	</tbody>
</table>
<div class="log"></div>

</body>
</html>
